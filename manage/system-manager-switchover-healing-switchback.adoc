---
permalink: manage/system-manager-switchover-healing-switchback.html 
sidebar: sidebar 
keywords: switchover, perform, switchback, system, manager, operation, restore, metrocluster, functionality, ip, configuration 
summary: スイッチオーバーに続いて、特定の順序で修復処理を実行して MetroCluster 機能をリストアする必要があります。 
---
= System Mangerを使用してスイッチオーバーとスイッチバックを実行する（MetroCluster IP構成のみ）
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
メンテナンスを実施したり、問題からリカバリしたりするために、あるMetroCluster IPサイトから別のサイトに制御を切り替えることができます。


NOTE: スイッチオーバーとスイッチバックの手順は、MetroCluster IP構成でのみサポートされます。



== スイッチオーバーとスイッチバックの概要

スイッチオーバーには次の2つのタイプがあります。

* * 計画的スイッチオーバー *
+
このスイッチオーバーは、システム管理者がSystem Managerを使用して開始します。計画的スイッチオーバーでは、ローカルクラスタのシステム管理者が制御を切り替えることで、リモートクラスタのデータサービスがローカルクラスタで処理されるようになります。これにより、リモートクラスタの場所にあるシステム管理者がリモートクラスタでメンテナンスを実行できるようになります。

* * 計画外スイッチオーバー *
+
MetroClusterクラスタが停止した場合やクラスタ間の接続が停止した場合、ONTAPによってスイッチオーバーが自動的に開始されるため、停止したクラスタのデータ処理が実行中のクラスタで処理されます。

+
一方のクラスタのステータスをONTAPが判断できない場合は、稼働しているサイトのシステム管理者がスイッチオーバーを開始して、もう一方のサイトのデータ処理を制御します。



どのタイプのスイッチオーバー手順の場合も、 _switchback プロセスを使用してデータサービス機能がクラスタに返されます。

実行するスイッチオーバーとスイッチバックのプロセスは、ONTAPのバージョンによって異なります。

* <<sm97-sosb,ONTAP 9.6または9.7のSystem Managerを使用してスイッチオーバーとスイッチバックを実行>>
* <<sm98-sosb,ONTAP 9.8以降のSystem Managerを使用してスイッチオーバーとスイッチバックを行う>>




== ONTAP 9.6または9.7のSystem Managerを使用してスイッチオーバーとスイッチバックを実行

.手順
. ONTAP 9.6または9.7でSystem Managerにログインします。
. *（クラシックバージョンに戻る）*をクリックします。
. [設定]>[ MetroCluster ]*をクリックします。
+
ネゴシエートスイッチオーバーが可能かどうかが検証されます。

. 検証プロセスが完了したら、次のいずれかの手順を実行します。
+
.. 検証に失敗し、サイトBが稼働している場合、エラーが発生しています。たとえば、サブシステムに問題があるか、NVRAMミラーリングが同期されていないことが考えられます。
+
... エラーの原因となっている問題を修正し、*[閉じる]*をクリックして、手順2からやり直します。
... サイトBのノードを停止し、*[閉じる]*をクリックして、の手順を実行します link:https://docs.netapp.com/us-en/ontap-system-manager-classic/online-help-96-97/task_performing_unplanned_switchover.html["計画外スイッチオーバーの実行"^]。


.. 検証が失敗し、サイトBが停止している場合は、接続に問題がある可能性があります。サイトBが停止していることを確認し、の手順を実行しますlink:https://docs.netapp.com/us-en/ontap-system-manager-classic/online-help-96-97/task_performing_unplanned_switchover.html["計画外スイッチオーバーの実行"^]。


. [サイトBからサイトAへのスイッチオーバー]*をクリックしてスイッチオーバープロセスを開始します。
. [新しいエクスペリエンスに切り替える]*をクリックします。




== ONTAP 9.8以降のSystem Managerを使用してスイッチオーバーとスイッチバックを行う



=== 計画的スイッチオーバーの実行（ONTAP 9.8以降）

.手順
. ONTAP 9.8以降でSystem Managerにログインします。
. 「 * ダッシュボード * 」を選択します。「 * MetroCluster * 」セクションには、 2 つのクラスタが接続されています。
. ローカルクラスタ（左側に表示）で、をクリック image:icon_kabob.gif["ケバブアイコン"]し、*[リモートデータサービスをローカルサイトにスイッチオーバーする]*を選択します。
+
スイッチオーバー要求が検証されると、リモートサイトからローカルサイトに制御が移されます。ローカルサイトが両方のクラスタに対してデータサービス要求を実行します。

+
リモートクラスタはリブートしますが、ストレージコンポーネントはアクティブではなく、クラスタはデータ要求を処理しません。計画的なメンテナンスのために利用できるようになりました。




NOTE: スイッチバックを実行するまでリモートクラスタをデータサービスに使用しないでください。



=== 計画外スイッチオーバーの実行（ONTAP 9.8以降）

計画外スイッチオーバーは、ONTAPによって自動的に開始される場合があります。ONTAPでスイッチバックが必要かどうかを判断できない場合は、実行中のMetroClusterサイトのシステム管理者が次の手順でスイッチオーバーを開始します。

.手順
. ONTAP 9.8以降でSystem Managerにログインします。
. 「 * ダッシュボード * 」を選択します。
+
MetroCluster *セクションでは、2つのクラスタ間の接続に「X」が表示されます。これは、接続を検出できず、接続またはクラスタのいずれかが停止していることを意味します。

. ローカルクラスタ（左側に表示）で、をクリック image:icon_kabob.gif["ケバブアイコン"]し、*[リモートデータサービスをローカルサイトにスイッチオーバーする]*を選択します。
+
スイッチオーバーがエラーで失敗した場合は、エラーメッセージの[詳細を表示]リンクをクリックして、計画外スイッチオーバーを確認します。

+
スイッチオーバー要求が検証されると、リモートサイトからローカルサイトに制御が移されます。ローカルサイトが両方のクラスタに対してデータサービス要求を実行します。

+
クラスタを再度オンラインにするには、クラスタを修復する必要があります。




NOTE: オンラインになったリモートクラスタは、スイッチバックを実行するまでデータサービスに使用しないでください。



=== スイッチバックの実行（ONTAP 9.8以降）

.作業を開始する前に
計画的なメンテナンスや災害が原因でリモートクラスタが停止していた場合は、リモートクラスタが稼働中で、スイッチバックを待機している必要があります。

.手順
. ローカルクラスタで、ONTAP 9.8以降のSystem Managerにログインします。
. 「 * ダッシュボード * 」を選択します。
+
「 * MetroCluster * 」セクションには、 2 つのクラスタが表示されます。

. ローカルクラスタ（左側に表示）でをクリックし image:icon_kabob.gif["ケバブアイコン"]、*[Take back control]*を選択します。
+
データは_healed_firstで、両方のクラスタ間でデータが同期およびミラーリングされていることを確認します。

. データの修復が完了したら、をクリックし image:icon_kabob.gif["ケバブアイコン"]、*[スイッチバックの開始]*を選択します。
+
スイッチバックが完了すると、両方のクラスタがアクティブになり、データ要求を処理します。さらに、データがミラーリングされ、クラスタ間で同期されています。


