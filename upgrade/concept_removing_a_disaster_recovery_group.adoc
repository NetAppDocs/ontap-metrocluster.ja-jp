---
permalink: upgrade/concept_removing_a_disaster_recovery_group.html 
sidebar: sidebar 
keywords:  
summary: ONTAP 9.8 以降では、 8 ノード MetroCluster 構成から DR グループを削除して、 4 ノード MetroCluster 構成を作成できます。 
---
= MetroCluster構成からDRグループを削除する
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
ONTAP 9.8 以降では、8 ノードMetroCluster構成からディザスタ リカバリ (DR) グループを削除して、4 ノードMetroCluster構成を作成できます。


NOTE: これらの手順は、移行およびシステム更新のワークフロー中に使用します。



== コンソールログを有効にする

NetAppでは、使用しているデバイスでコンソールロギングをイネーブルにし、この手順を実行する際に次のアクションを実行することを強く推奨します。

* メンテナンス中はAutoSupportを有効のままにします。
* メンテナンスの前後にメンテナンスAutoSupportメッセージをトリガーして、メンテナンスアクティビティ中にケースの作成を無効にします。
+
ナレッジベースの記事を参照してください link:https://kb.netapp.com/Support_Bulletins/Customer_Bulletins/SU92["スケジュールされたメンテナンス時間中にケースの自動作成を停止する方法"^]。

* 任意のCLIセッションのセッションロギングをイネーブルにします。セッションログを有効にする方法については、ナレッジベースの記事の「セッション出力のログ」セクションを参照してください link:https://kb.netapp.com/on-prem/ontap/Ontap_OS/OS-KBs/How_to_configure_PuTTY_for_optimal_connectivity_to_ONTAP_systems["ONTAPシステムへの接続を最適化するためのPuTTYの設定方法"^]。




== 各クラスタからDRグループノードを削除します

この手順は、 ONTAP 9.8 以降でサポートされています。  ONTAP 9.7 以前を実行しているシステムの場合は、次のナレッジベースの記事を参照してください。link:https://kb.netapp.com/Advice_and_Troubleshooting/Data_Protection_and_Security/MetroCluster/How_to_remove_a_DR-Group_from_a_MetroCluster["MetroCluster 構成からDRグループを削除する方法"^] 。

.このタスクについて
8 ノード構成では、 8 つのノードが 2 つの 4 ノード DR グループとして編成されています。

image::../media/mcc_dr_groups_8_node.gif[MCC DR グループ 8 ノード]

DR グループを削除すると、構成内に 4 つのノードが残ります。

image::../media/mcc_dr_groups_4_node.gif[MCC DR グループ 4 ノード]

.作業を開始する前に
* この手順は両方のクラスタで実行する必要があります。
* 「 MetroCluster remove-dr-group 」コマンドは、 ONTAP 9.8 以降でのみサポートされます。


.手順
. まだ DR グループを削除していない場合は、削除する準備をします。
+
.. すべてのデータボリュームを別の DR グループに移動します。
.. 削除する DR グループに負荷共有ミラー ボリュームがある場合は、別の DR グループにすべての負荷共有ミラー ボリュームを再作成し、削除する DR グループからそれらを削除します。
.. の手順に従って、すべてのMDV_CRSメタデータボリュームを別のDRグループに移動します link:https://docs.netapp.com/us-en/ontap-metrocluster/upgrade/task_move_a_metadata_volume_in_mcc_configurations.html["MetroCluster 構成でのメタデータボリュームの移動"] 手順
.. 削除する DR グループにある MDV_AUD メタデータボリュームをすべて削除してください。
.. 削除する DR グループ内のすべてのデータ集約を削除します。
+
[listing]
----
ClusterA::> storage aggregate show -node ClusterA-01, ClusterA-02 -fields aggregate ,node
ClusterA::> aggr delete -aggregate aggregate_name
ClusterB::> storage aggregate show -node ClusterB-01, ClusterB-02 -fields aggregate ,node
ClusterB::> aggr delete -aggregate aggregate_name
----
+

NOTE: ルートアグリゲートは削除されません。

.. NFS および CIFS (SMB) に使用するすべての NAS データ LIF を別の DR グループ内のホーム ノードに移行します。+ 
`network interface show -home-node <old_node>`
+
`network interface migrate -vserver <svm_name> -lif <data_lif> -destination-node <new_node> -destination-port <port>`

.. データ LIF を別の DR グループ内の新しいホーム ノードに移動します。
`network interface modify -vserver <svm-name> -lif <data-lif> -home-node <new_node> -home-port <port>`
.. クラスタ管理 LIF を別の DR グループのホームノードに移行する。
+
network interface show -role cluster-mgmt-`

+
`network interface modify -vserver <svm-name> -lif <cluster_mgmt> -home-node <new_node> -home-port <port-id>`

+
[NOTE]
====
*** ノード管理LIFとクラスタ間LIFは移行されません。必要に応じて、DR グループのノードに新しいノード管理 LIF とクラスタ間 LIF を作成します。
*** ブロック アクセス (SAN) に使用される FCP インターフェイスをノード間で移行または移動することはできません。必要に応じて新しい FCP インターフェイスを作成します。
*** ホーム ノードとホーム ポートを更新する前に、iSCSI SAN LIF を停止する必要があります。


====
.. 必要に応じて、別の DR グループ内のノードにイプシロンを移動します。
+
[listing]
----
ClusterA::> set advanced
ClusterA::*> cluster show
Move epsilon if needed
ClusterA::*> cluster modify -node nodename -epsilon false
ClusterA::*> cluster modify -node nodename -epsilon true

ClusterB::> set advanced
ClusterB::*> cluster show
ClusterB::*> cluster modify -node nodename -epsilon false
ClusterB::*> cluster modify -node nodename -epsilon true
ClusterB::*> set admin
----


. DR グループを特定して削除します。
+
.. 削除する適切な DR グループを特定します。
+
MetroCluster node show

.. DR グループノードを削除します。 +dr-dr MetroCluster -group-dr -group-id 1'
+
次の例は、 cluster_A の DR グループ構成を削除します

+
.例
[%collapsible]
====
[listing]
----
cluster_A::*>

Warning: Nodes in the DR group that are removed from the MetroCluster
         configuration will lose their disaster recovery protection.

         Local nodes "node_A_1-FC, node_A_2-FC"will be removed from the
         MetroCluster configuration. You must repeat the operation on the
         partner cluster "cluster_B"to remove the remote nodes in the DR group.
Do you want to continue? {y|n}: y

Info: The following preparation steps must be completed on the local and partner
      clusters before removing a DR group.

      1. Move all data volumes to another DR group.
      2. Move all MDV_CRS metadata volumes to another DR group.
      3. Delete all MDV_aud metadata volumes that may exist in the DR group to
      be removed.
      4. Delete all data aggregates in the DR group to be removed. Root
      aggregates are not deleted.
      5. Migrate all data LIFs to home nodes in another DR group.
      6. Migrate the cluster management LIF to a home node in another DR group.
      Node management and inter-cluster LIFs are not migrated.
      7. Transfer epsilon to a node in another DR group.

      The command is vetoed if the preparation steps are not completed on the
      local and partner clusters.
Do you want to continue? {y|n}: y
[Job 513] Job succeeded: Remove DR Group is successful.

cluster_A::*>
----
====


. パートナークラスタで同じ手順を繰り返します。
. 古い DR グループのノードでストレージ フェイルオーバーを無効にします。
+
`storage failover modify -node <node-name> -enable false`

. MetroCluster IP 構成の場合は、次の手順を実行して、ルート アグリゲートのリモート プレックスを削除し、古い DR グループのノード上のディスク所有権を削除します。
+
これらの手順は、各サイトの HA ペアの両方のノードに対して実行する必要があります。

+
.. 削除する DR グループ内のノード上のルート アグリゲートのリモート プレックスを表示します。
+
`storage aggregate plex show -aggregate <root_aggr_name> -pool 1`

.. リモート プレックスを削除します。
+
`storage aggregate plex delete -aggregate <root_aggr_name> -plex <plex_from_previous_step>`

.. DR グループ内のノードが所有するリモート ディスクを識別します。
+
使用するコマンドは、パーティション/共有ディスクを使用しているか、ディスク全体を使用しているかによって異なります。

+

NOTE: カンマ区切りのリストを使用してください `-owner <node_names>`削除する DR グループ内のノード名を指定するフィールド。

+
[role="tabbed-block"]
====
.パーティション/共有ディスク:
--
... 権限レベルを advanced に設定します。
+
「高度」

... リモート ディスクを表示します。
+
`storage disk show -pool Pool1 -owner <node_names> -partition-ownership`



--
.ディスク全体:
--
... 権限レベルを advanced に設定します。
+
「高度」

... リモート ディスクを表示します。
+
`storage disk show -pool Pool1 -owner <node_names>`



--
====
.. ディスクの自動割り当てを無効にする:
+
`disk option modify -node <node_names_in_the_DR_group_to_be_deleted>  -autoassign off`

.. 削除する各 DR グループ ノード上の pool1 ディスクの所有権を削除します。削除する各ノードに対してこれらの手順を実行します。
+
... ノードシェルに移動します。
+
`run -node <node_name>`

... pool1 ディスクを識別します。
+
`aggr status -s`

+
ノードが所有するプール 0 およびプール 1 スペア ディスクを含むすべてのスペア ディスクが表示されます。

... 各プール1スペアディスクのディスク所有権を削除します。
+
`disk remove_ownership <disk_name>`

+
パーティション化されたディスクの場合は、パーティションの所有権を削除してから、コンテナ ディスクの所有権を削除します。





. MetroCluster IP 構成の場合は、古い DR グループのノード上のMetroCluster接続を削除します。
+
これらのコマンドはどちらのクラスターからも発行でき、両方のクラスターにまたがる DR グループ全体に適用されます。

+
.. 接続を切断します。
+
`metrocluster configuration-settings connection disconnect -dr-group-id <dr_group_id>`

+
.例
[%collapsible]
====
[listing]
----
cluster_A::*> metrocluster configuration-settings connection disconnect -dr-group-id 1

Warning: For the nodes in the DR group 1, this command will remove the existing connections that are used to mirror NV logs and access remote storage.
Do you want to continue? {y|n}: y

Warning: Before proceeding with disconnect, you must verify the following:
      1. Unmirrored aggregates do not have disks in remote plexes.
      2. Aggregates are not mirrored.
      3. No disks are assigned in Pool1.
      4. Storage failover is not enabled.
      Follow the "MetroCluster Installation and Configuration guide" for detailed instructions to verify this.
Do you want to continue? {y|n}: y
----
====
.. 古い DR グループのノード上の MetroCluster インターフェイスを削除します。
+

NOTE: この手順は、DR グループの各ノードで繰り返す必要があります。

+
MetroCluster 構成設定インタフェースは削除されます

.. 古い DR グループの構成を削除します。+ MetroCluster 構成設定 DR-group delete


. 古い DR グループからノードを分離
+
各クラスターでこの手順を実行します。

+
.. advanced 権限レベルを設定します。
+
「 advanced 」の権限が必要です

.. ノードを切断: +
`cluster unjoin -node <node-name>`
+
古い DR グループ内のもう一方のローカルノードに対して、この手順を繰り返します。

.. 権限レベルをadminに設定します。
+
「特権管理者」



. 新しい DR グループでクラスター HA が有効になっていることを確認します。必要に応じて、クラスター HA を再度有効にします。
+
cluster ha modify -configured true

+
各クラスターでこの手順を実行します。

. 古いコントローラモジュールとストレージシェルフを停止、電源オフ、および取り外します。

