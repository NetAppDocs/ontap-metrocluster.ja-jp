---
permalink: upgrade/task_refresh_4n_mcc_ip.html 
sidebar: sidebar 
keywords: metrocluster, upgrade, refresh, four, node, ip, configuration, add, autosupport 
summary: ONTAP 9.8 以降では、 4 ノード MetroCluster IP 構成のコントローラとストレージをアップグレードできます。そのためには、構成を拡張して一時的な 8 ノード構成にし、古いディザスタリカバリ（ DR ）グループを削除します。 
---
= 4 ノード MetroCluster IP 構成の更新（ ONTAP 9.8 以降）
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
ONTAP 9.8 以降では、 4 ノード MetroCluster IP 構成のコントローラとストレージをアップグレードできます。そのためには、構成を拡張して一時的な 8 ノード構成にし、古いディザスタリカバリ（ DR ）グループを削除します。

.このタスクについて
* この手順は、 ONTAP 9.8 以降を実行しているシステムでサポートされています。
* IP スイッチをアップグレードする場合は、このリフレッシュ手順を実行する前にスイッチをアップグレードする必要があります。
* 「古いノード」とは、置き換えるノードを意味します。
* この手順 を使用できるのは、MetroCluster FC構成の特定のプラットフォームモデルのみです。
+
** サポートされているプラットフォームアップグレードの組み合わせについては、のMetroCluster IP更新の表を参照してください link:../upgrade/concept_choosing_tech_refresh_mcc.html#supported-metrocluster-ip-tech-refresh-combinations["システムの更新方法を選択する"]。




.手順
. 古いノードから情報を収集します。
+
この段階では、次の図に示すように 4 ノード構成が表示されます。

+
image::../media/mcc_dr_group_a.png[MCC DR グループ A]

. サポートケースが自動で生成されないようにするには、アップグレードが進行中であることを示す AutoSupport メッセージを送信します。
+
.. 次のコマンドを問題で実行します。 + 「 system node AutoSupport invoke -node * -type all -message 」 MAINT=10h Upgrading _old-model_To _new-model 」 _`
+
次の例は、 10 時間のメンテナンス時間を指定します。プランによっては、さらに時間をかけたい場合もあります。

+
この時間が経過する前にメンテナンスが完了した場合は、メンテナンス期間が終了したことを通知する AutoSupport メッセージを起動できます。

+
「 system node AutoSupport invoke -node * -type all -message MAINT= end 」というメッセージが表示されます

.. パートナークラスタに対してこのコマンドを繰り返します。


. Tiebreaker 、メディエーター、またはスイッチオーバーを開始できるその他のソフトウェアから既存の MetroCluster 構成を削除します。
+
[cols="2*"]
|===


| 使用するポート | 使用する手順 


 a| 
Tiebreaker
 a| 
link:../tiebreaker/concept_configuring_the_tiebreaker_software.html#commands-for-modifying-metrocluster-tiebreaker-configurations["MetroCluster 設定の削除"] MetroCluster Tiebreaker インストールおよび設定ガイドのを参照してください



 a| 
メディエーター
 a| 
ONTAP プロンプトで次のコマンドを問題に設定します。

MetroCluster 構成設定のメディエーターが削除されました



 a| 
サードパーティ製アプリケーション
 a| 
製品マニュアルを参照してください。

|===
. のすべての手順を実行します link:../upgrade/task_expand_a_four_node_mcc_ip_configuration.html["4 ノード MetroCluster IP 構成から 8 ノード構成への拡張"] をクリックして新しいノードとストレージを構成に追加してください。
+
拡張手順が完了すると、次の図のような構成が表示されます。

+
image::../media/mcc_dr_group_b.png[MCC DR グループ b]

. CRS ボリュームを移動します。
+
の手順を実行します link:../maintain/task_move_a_metadata_volume_in_mcc_configurations.html["MetroCluster 構成でのメタデータボリュームの移動"]。

. の次の手順に従って、古いノードから新しいノードにデータを移動します https://docs.netapp.com/platstor/topic/com.netapp.doc.hw-upgrade-controller/home.html["その他のプラットフォーム手順： Controller Hardware Upgrade Express Guide"^]
+
.. のすべての手順を実行します http://docs.netapp.com/platstor/topic/com.netapp.doc.hw-upgrade-controller/GUID-AFE432F6-60AD-4A79-86C0-C7D12957FA63.html["アグリゲートの作成と新しいノードへのボリュームの移動"^]。
+

NOTE: アグリゲートのミラーリングは、作成時または作成後に実行できます。

.. のすべての手順を実行します http://docs.netapp.com/platstor/topic/com.netapp.doc.hw-upgrade-controller/GUID-95CA9262-327D-431D-81AA-C73DEFF3DEE2.html["SAN 以外のデータ LIF とクラスタ管理 LIF を新しいノードに移動する"]。


. 手順の手順に従って、古い DR グループを削除します。
+
link:concept_removing_a_disaster_recovery_group.html["ディザスタリカバリグループを削除しています"]

+
古い DR グループ（ DR グループ 1 ）を削除すると、次の図のような構成が表示されます。

+
image::../media/mcc_dr_group_d.png[MCC DR グループ d]

. MetroCluster 構成の運用モードを確認し、 MetroCluster チェックを実行
+
.. MetroCluster 構成と運用モードが正常な状態であることを確認します。
+
「 MetroCluster show 」

.. 想定されるすべてのノードが表示されることを確認します。
+
MetroCluster node show

.. 次のコマンドを問題に設定します。
+
「 MetroCluster check run 」のようになります

.. MetroCluster チェックの結果を表示します。
+
MetroCluster チェックショー



. 必要に応じて、構成に応じて手順を使用してリストアを監視します。
+
[cols="2*"]
|===


| 使用するポート | この手順を使用します 


 a| 
Tiebreaker
 a| 
link:../tiebreaker/concept_configuring_the_tiebreaker_software.html#adding-metrocluster-configurations["MetroCluster 構成を追加しています"] MetroCluster Tiebreaker のインストールと設定



 a| 
メディエーター
 a| 
リンク： ./install-ip/concept_mediator_requirements.html [Configuring the ONTAP Mediator service from a MetroCluster IP configuration] （ _ MetroCluster IP インストールおよび設定 _ でのメディエーターサービスの設定）



 a| 
サードパーティ製アプリケーション
 a| 
製品マニュアルを参照してください。

|===
. サポートケースの自動生成を再開するには、メンテナンスが完了したことを示す AutoSupport メッセージを送信します。
+
.. 次のコマンドを問題に設定します。
+
「 system node AutoSupport invoke -node * -type all -message MAINT= end 」というメッセージが表示されます

.. パートナークラスタに対してこのコマンドを繰り返します。



